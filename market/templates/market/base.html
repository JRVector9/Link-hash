<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>LinkHash Market</title>

  {% load static %}

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Theme -->
  <link rel="stylesheet" href="{% static 'market/theme.css' %}?v=1011">

  <!-- Mobile responsive styles -->
  <style>
    @media (max-width: 768px) {
      .container {
        padding-left: 16px !important;
        padding-right: 16px !important;
      }

      .lhx-nav {
        padding: 10px 0 !important;
      }

      .lhx-nav .container {
        flex-wrap: nowrap;
      }

      /* Hide desktop menu on mobile */
      .lhx-nav-menu {
        display: none !important;
      }

      /* Show hamburger button */
      .lhx-hamburger {
        display: flex !important;
        flex-direction: column;
        justify-content: space-between;
        width: 44px;
        height: 44px;
        padding: 10px;
        background: transparent;
        border: none;
        cursor: pointer;
        border-radius: 8px;
        transition: background 0.2s;
      }

      .lhx-hamburger:active {
        background: rgba(255, 255, 255, 0.1);
      }

      .hamburger-line {
        display: block;
        width: 100%;
        height: 3px;
        background: #00ffa3;
        border-radius: 2px;
        transition: all 0.3s ease;
      }

      /* Mobile menu overlay */
      .lhx-mobile-menu {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        height: 100dvh; /* Dynamic viewport height for mobile */
        background: rgba(11, 15, 14, 0.98);
        backdrop-filter: blur(10px);
        z-index: 1000;
        display: none;
        flex-direction: column;
        padding: 20px;
        overflow-y: auto;
        overscroll-behavior: contain; /* Prevent scroll chaining */
        -webkit-overflow-scrolling: touch;
        touch-action: pan-y; /* Only vertical scroll */
      }

      .lhx-mobile-menu.active {
        display: flex !important;
      }

      /* Prevent body scroll when menu is open */
      body.menu-open {
        overflow: hidden !important;
        position: fixed !important;
        width: 100% !important;
        height: 100vh !important;
      }

      .lhx-mobile-menu-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
      }

      .lhx-mobile-menu-close {
        background: none;
        border: none;
        color: #fff;
        font-size: 32px;
        cursor: pointer;
        padding: 10px;
        line-height: 1;
      }

      .lhx-mobile-menu-link {
        display: block;
        color: rgba(255,255,255,0.9);
        text-decoration: none;
        padding: 16px 0;
        font-size: 18px;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        transition: color 0.2s;
      }

      .lhx-mobile-menu-link:hover {
        color: #00ffa3;
      }

      .lhx-h1 {
        font-size: 28px !important;
        line-height: 1.3 !important;
      }

      .lhx-h2 {
        font-size: 22px !important;
      }

      .lhx-card {
        padding: 16px !important;
      }

      .lhx-table {
        font-size: 13px;
      }

      .lhx-logo {
        width: 48px !important;
        height: 48px !important;
      }

      /* Hide some elements on mobile */
      .d-md-block {
        display: none !important;
      }

      /* Stack cards vertically */
      .row > [class*='col-'] {
        width: 100% !important;
        flex: 0 0 100% !important;
        max-width: 100% !important;
      }

      /* Fix card padding issues */
      .lhx-card {
        overflow: hidden;
      }

      .lhx-card table {
        margin: 0 !important;
      }

      .lhx-card .table {
        margin-bottom: 0 !important;
      }

      /* Remove gaps in cards */
      .lhx-card.p-0 {
        padding: 0 !important;
      }

      .lhx-card.p-0 > * {
        margin: 0 !important;
      }

      /* Table inside cards - no spacing */
      .table-dark {
        background-color: var(--lhx-card) !important;
      }

      .table > :not(caption) > * > * {
        padding: 12px 16px !important;
        background-color: transparent !important;
      }

      /* Mobile table improvements */
      .lhx-card {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      /* Show scroll hint for tables */
      .lhx-card table {
        min-width: 100%;
      }

      /* Make table columns narrower on mobile */
      .lhx-table {
        font-size: 12px !important;
      }

      .lhx-table th,
      .lhx-table td {
        padding: 8px 6px !important;
        white-space: nowrap;
      }

      /* Hide less important columns on very small screens */
      @media (max-width: 480px) {
        .lhx-table .d-none-xs {
          display: none !important;
        }
      }

      /* Scroll indicator */
      .lhx-card-scroll-hint {
        display: block;
        text-align: center;
        padding: 8px;
        background: rgba(0, 255, 163, 0.1);
        color: #00ffa3;
        font-size: 12px;
        border-top: 1px solid rgba(0, 255, 163, 0.2);
      }
    }
  </style>

  <!-- Global card fixes (all screen sizes) -->
  <style>
    /* Ensure cards have no internal gaps */
    .lhx-card {
      display: block;
      overflow: hidden;
    }

    .lhx-card.p-0 {
      padding: 0;
    }

    /* Tables in cards should have no margin */
    .lhx-card table,
    .lhx-card .table {
      margin: 0;
      border-collapse: collapse;
    }

    /* First and last rows should align to card edges */
    .lhx-card .table tbody tr:first-child td {
      border-top: none;
    }

    .lhx-card .table tbody tr:last-child td {
      border-bottom: none;
    }

    /* Remove Bootstrap table borders inside cards */
    .lhx-card .table-dark {
      --bs-table-bg: transparent;
      --bs-table-border-color: rgba(255, 255, 255, 0.05);
    }

    /* Ensure table background matches card */
    .table-dark {
      background-color: var(--lhx-card);
    }

    .table-dark tbody {
      background-color: transparent;
    }
  </style>

  <!-- ‚úÖ Solana + bs58 MUST be loaded BEFORE login script -->
  <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>

  <!-- ‚úÖ CSRF helper (Django) -->
  <script>
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
  </script>
</head>

<body class="lhx-bg">
  <nav class="lhx-nav">
    <div class="container d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center gap-2">
        <span class="lhx-dot"></span>
        <span class="lhx-brand">LinkHash</span>
      </div>

      <!-- Hamburger button (hidden on desktop) -->
      <button class="lhx-hamburger" style="display: none;" id="mobileMenuBtn" type="button">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>

      <!-- Desktop menu -->
      <div class="d-flex align-items-center gap-3 lhx-nav-menu">
        <a class="lhx-navlink" href="/">Signals</a>
        <a class="lhx-navlink" href="{% url 'about' %}">About</a>
        <a class="lhx-navlink" href="{% url 'partnership' %}">Partnership</a>
        <a class="lhx-navlink" href="{% url 'campaign_list' %}">Campaigns</a>
        <a class="lhx-navlink" href="{% url 'games_home' %}">Games</a>
        <a class="lhx-navlink" href="{% url 'leaderboard' %}">Leaderboard</a>
        <a class="lhx-navlink" href="{% url 'announcement_list' %}">Announcements</a>
        <a class="lhx-navlink" href="{% url 'prediction_plus' %}">Prediction+</a>

        {% if request.session.wallet_address %}
          <div class="lhx-account-wrap" id="lhxAccountWrap">
            <button class="lhx-account-chip" type="button" id="lhxAccountBtn">
              <img class="lhx-account-icon" src="{% static 'market/icons/phantom.png' %}" alt="Phantom">
              <span class="lhx-mono">
                {{ request.session.wallet_address|slice:":4" }}...{{ request.session.wallet_address|slice:"-4:" }}
              </span>
              <span class="lhx-caret">‚ñæ</span>
            </button>

            <div class="lhx-account-menu" id="lhxAccountMenu">
              <a class="lhx-account-item" href="{% url 'profile' %}">
                <span class="lhx-account-item-ico">üë§</span> Profile
              </a>
              <!--
              <a class="lhx-account-item" href="{% url 'settings' %}">
                <span class="lhx-account-item-ico">‚öôÔ∏è</span> Settings
              </a>
              -->
              <div class="lhx-account-divider"></div>
              <a class="lhx-account-item lhx-danger" href="{% url 'logout' %}">
                <span class="lhx-account-item-ico">‚éã</span> Logout
              </a>
            </div>
          </div>
        {% else %}
          <button class="lhx-btn" type="button" id="lhxConnectBtn">Connect Wallet</button>
        {% endif %}
      </div>
    </div>
  </nav>

  <!-- Mobile menu overlay -->
  <div class="lhx-mobile-menu" id="mobileMenu">
    <div class="lhx-mobile-menu-header">
      <div class="d-flex align-items-center gap-2">
        <span class="lhx-dot"></span>
        <span class="lhx-brand">LinkHash</span>
      </div>
      <button class="lhx-mobile-menu-close" id="mobileMenuClose">&times;</button>
    </div>
    <a class="lhx-mobile-menu-link" href="/">Signals</a>
    <a class="lhx-mobile-menu-link" href="{% url 'about' %}">About</a>
    <a class="lhx-mobile-menu-link" href="{% url 'partnership' %}">Partnership</a>
    <a class="lhx-mobile-menu-link" href="{% url 'campaign_list' %}">Campaigns</a>
    <a class="lhx-mobile-menu-link" href="{% url 'games_home' %}">Games</a>
    <a class="lhx-mobile-menu-link" href="{% url 'leaderboard' %}">Leaderboard</a>
    <a class="lhx-mobile-menu-link" href="{% url 'announcement_list' %}">Announcements</a>
    <a class="lhx-mobile-menu-link" href="{% url 'prediction_plus' %}">Prediction+</a>
    {% if request.session.wallet_address %}
      <a class="lhx-mobile-menu-link" href="{% url 'profile' %}">Profile</a>
      <a class="lhx-mobile-menu-link" href="{% url 'logout' %}">Logout</a>
    {% else %}
      <button class="lhx-btn mt-3" type="button" id="lhxConnectBtnMobile">Connect Wallet</button>
    {% endif %}
  </div>

  <script>
    // Mobile menu toggle with improved scroll prevention
    document.addEventListener('DOMContentLoaded', function() {
      const menuBtn = document.getElementById('mobileMenuBtn');
      const mobileMenu = document.getElementById('mobileMenu');
      const closeBtn = document.getElementById('mobileMenuClose');
      let scrollY = 0;

      function openMenu() {
        // Save current scroll position
        scrollY = window.scrollY;

        // Add classes to prevent scroll
        document.body.classList.add('menu-open');
        document.body.style.top = `-${scrollY}px`;
        mobileMenu.classList.add('active');
      }

      function closeMenu() {
        // Remove classes
        mobileMenu.classList.remove('active');
        document.body.classList.remove('menu-open');
        document.body.style.top = '';

        // Restore scroll position
        window.scrollTo(0, scrollY);
      }

      if (menuBtn && mobileMenu && closeBtn) {
        menuBtn.addEventListener('click', openMenu);
        closeBtn.addEventListener('click', closeMenu);

        // Close on link click
        const links = mobileMenu.querySelectorAll('.lhx-mobile-menu-link');
        links.forEach(link => {
          link.addEventListener('click', closeMenu);
        });

        // Close on backdrop tap (outside menu content)
        mobileMenu.addEventListener('click', function(e) {
          if (e.target === mobileMenu) {
            closeMenu();
          }
        });
      }

      // Add scroll hint to tables on mobile
      if (window.innerWidth <= 768) {
        const tables = document.querySelectorAll('.lhx-card table');
        tables.forEach(table => {
          const card = table.closest('.lhx-card');
          if (card && table.scrollWidth > card.clientWidth) {
            const hint = document.createElement('div');
            hint.className = 'lhx-card-scroll-hint';
            hint.innerHTML = '‚Üê Swipe to see more ‚Üí';
            card.appendChild(hint);

            // Remove hint after first scroll
            card.addEventListener('scroll', function() {
              if (hint.parentNode) {
                hint.remove();
              }
            }, { once: true });
          }
        });
      }
    });
  </script>

  {% if messages %}
    <div class="container mt-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} mb-2">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  <main class="container py-5">
    {% block content %}{% endblock %}
  </main>

  <!-- ‚úÖ On-chain Info Modal -->
  <div class="modal fade" id="onchainModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="background: rgba(20,26,24,0.96); border: 1px solid rgba(80,255,180,0.18); border-radius: 18px;">
        <div class="modal-header" style="border-bottom: 1px solid rgba(255,255,255,0.06);">
          <div>
            <div class="lhx-title" id="onchainModalTitle" style="margin:0;">On-chain Info</div>
            <div class="small lhx-muted lhx-mono" id="onchainModalSub" style="margin-top:4px;"></div>
          </div>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <div id="onchainModalBody" class="lhx-muted small">Loading...</div>
        </div>

        <div class="modal-footer" style="border-top: 1px solid rgba(255,255,255,0.06);">
          <button type="button" class="lhx-btn-outline" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- JS libs -->
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
  // =========================
  // Drag-scroll carousel
  // =========================
  document.querySelectorAll('[data-drag-scroll]').forEach((track) => {
    const intervalMs = parseInt(track.dataset.intervalMs || "5000", 10);

    let autoTimer = null;
    let isDragging = false;

    const startAuto = () => {
      stopAuto();
      autoTimer = setInterval(() => {
        if (isDragging) return;

        const maxScroll = track.scrollWidth - track.clientWidth;
        const step = track.clientWidth;

        if (track.scrollLeft + step >= maxScroll - 5) {
          track.scrollTo({ left: 0, behavior: "smooth" });
        } else {
          track.scrollBy({ left: step, behavior: "smooth" });
        }
      }, intervalMs);
    };

    const stopAuto = () => {
      if (autoTimer) clearInterval(autoTimer);
      autoTimer = null;
    };

    let startX = 0;
    let scrollStart = 0;
    let moved = false;

    track.addEventListener("pointerdown", (e) => {
      isDragging = true;
      moved = false;
      startX = e.pageX;
      scrollStart = track.scrollLeft;
      track.setPointerCapture(e.pointerId);
      stopAuto();
    });

    track.addEventListener("pointermove", (e) => {
      if (!isDragging) return;
      const dx = e.pageX - startX;
      if (Math.abs(dx) > 3) moved = true;
      track.scrollLeft = scrollStart - dx;
    });

    const endDrag = () => {
      if (!isDragging) return;
      isDragging = false;
      setTimeout(startAuto, intervalMs);
    };

    track.addEventListener("pointerup", endDrag);
    track.addEventListener("pointercancel", endDrag);
    track.addEventListener("pointerleave", endDrag);

    track.addEventListener("click", (e) => {
      if (moved) {
        e.preventDefault();
        e.stopPropagation();
      }
      moved = false;
    }, true);

    startAuto();
  });

  // =========================
  // HTMX scroll after swap
  // =========================
  document.body.addEventListener('htmx:afterSwap', function (evt) {
    const swapped = evt.detail.target;
    if (!swapped || !swapped.id) return;
    const y = swapped.getBoundingClientRect().top + window.pageYOffset - 90;
    window.scrollTo({ top: y, behavior: "smooth" });
  });

  // =========================
  // Sponsored On-chain Modal
  // =========================
  function escapeHtml(s) {
    return (s || "").replace(/[&<>"']/g, function (m) {
      return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]);
    });
  }

  function renderOnchainBody(data) {
    const holders = (data && data.holders_count != null) ? Number(data.holders_count).toLocaleString() : "-";
    const top20 = (data && data.top20_share_pct != null) ? `${Number(data.top20_share_pct).toFixed(2)}%` : "-";
    const whales = (data && data.whales_ge_1pct_count != null) ? Number(data.whales_ge_1pct_count).toLocaleString() : "-";

    return `
      <div class="d-flex flex-column gap-2">
        <div class="d-flex justify-content-between">
          <span class="lhx-muted">Holders</span>
          <span class="lhx-mono">${holders}</span>
        </div>
        <div class="d-flex justify-content-between">
          <span class="lhx-muted">Top 20 share</span>
          <span class="lhx-mono">${top20}</span>
        </div>
        <div class="d-flex justify-content-between">
          <span class="lhx-muted">Whales (‚â• 1%)</span>
          <span class="lhx-mono">${whales}</span>
        </div>
        <div class="mt-2 small text-secondary">Source: on-chain (Helius)</div>
      </div>
    `;
  }

  async function openOnchainModal(btn) {
    const name = btn.getAttribute("data-token-name") || "Token";
    const addr = btn.getAttribute("data-token-address") || "";
    const url  = btn.getAttribute("data-onchain-url");

    const titleEl = document.getElementById("onchainModalTitle");
    const subEl = document.getElementById("onchainModalSub");
    const bodyEl = document.getElementById("onchainModalBody");

    titleEl.textContent = `${name} ¬∑ On-chain Info`;
    subEl.textContent = addr ? `${addr.slice(0,6)}...${addr.slice(-6)}` : "";
    bodyEl.textContent = "Loading...";

    const modal = new bootstrap.Modal(document.getElementById("onchainModal"));
    modal.show();

    try {
      const res = await fetch(url, { headers: { "Accept": "application/json" } });
      const data = await res.json();

      if (!res.ok || data.error) {
        bodyEl.innerHTML = `<div class="text-danger small">${escapeHtml(data.error || "Failed to fetch")}</div>`;
        return;
      }
      bodyEl.innerHTML = renderOnchainBody(data);

    } catch (e) {
      bodyEl.innerHTML = `<div class="text-danger small">Network error</div>`;
    }
  }

  document.addEventListener("click", function(e){
    const btn = e.target.closest("[data-onchain-btn]");
    if (!btn) return;
    e.preventDefault();
    openOnchainModal(btn);
  });
  </script>

  <!-- =========================
       ‚úÖ Phantom Login + Dropdown
       ========================= -->
<script>
(function(){
  const connectBtn = document.getElementById("lhxConnectBtn");

  function base58Encode(bytes) {
    const ALPHABET = "123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";
    if (!bytes || bytes.length === 0) return "";
    let digits = [0];
    for (let i = 0; i < bytes.length; i++) {
      let carry = bytes[i];
      for (let j = 0; j < digits.length; j++) {
        const x = digits[j] * 256 + carry;
        digits[j] = x % 58;
        carry = (x / 58) | 0;
      }
      while (carry) {
        digits.push(carry % 58);
        carry = (carry / 58) | 0;
      }
    }
    let zeros = 0;
    while (zeros < bytes.length && bytes[zeros] === 0) zeros++;
    let str = "";
    for (let i = 0; i < zeros; i++) str += "1";
    for (let i = digits.length - 1; i >= 0; i--) str += ALPHABET[digits[i]];
    return str;
  }

  function getPhantomProvider() {
    // Prefer Phantom‚Äôs official injection
    const p = window.phantom?.solana;
    if (p && p.isPhantom) return p;

    // Fallback (can be other wallets too)
    const s = window.solana;
    if (s && s.isPhantom) return s;

    return null;
  }

  function explainEnvironmentIfBad() {
    // Phantom often fails in iframes / embedded browsers or non-secure contexts.
    const inIframe = (window.top !== window.self);
    const secure = (window.isSecureContext === true);

    console.log("[Phantom env]", {
      href: location.href,
      origin: location.origin,
      userAgent: navigator.userAgent,
      inIframe,
      isSecureContext: secure,
      hasWindowPhantom: !!window.phantom,
      hasWindowSolana: !!window.solana,
    });

    if (inIframe) {
      alert("Wallet connect blocked: this page is running inside an iframe/embedded browser. Open in a normal browser tab (Chrome/Safari) directly.");
      return false;
    }

    if (!secure) {
      alert("Wallet connect blocked: page is not in a secure context. Use HTTPS (or localhost).");
      return false;
    }

    return true;
  }

  async function doConnect(provider) {
    // Try to clear stale connection state (safe if not connected)
    try { await provider.disconnect(); } catch (_) {}

    // Primary path
    try {
      return await provider.connect({ onlyIfTrusted: false });
    } catch (e1) {
      // Fallback path (some provider builds expose request())
      try {
        if (typeof provider.request === "function") {
          const r = await provider.request({ method: "connect" });
          // Some implementations return { publicKey }, some return nothing but set provider.publicKey
          if (r && r.publicKey) return r;
          if (provider.publicKey) return { publicKey: provider.publicKey };
        }
      } catch (e2) {
        // Re-throw the original (more relevant) error if fallback also fails
      }
      throw e1;
    }
  }

  async function connectPhantom(e) {
    try {
      if (e) { e.preventDefault(); e.stopPropagation(); }

      if (!explainEnvironmentIfBad()) return;

      const provider = getPhantomProvider();
      if (!provider) {
        alert("Phantom wallet not found. Please install Phantom extension/app.");
        return;
      }

      console.log("Phantom provider detected:", provider);

      // (Optional) log events for debugging
      try {
        provider.on?.("connect", (pk) => console.log("[Phantom event] connect", pk?.toString?.() || pk));
        provider.on?.("disconnect", () => console.log("[Phantom event] disconnect"));
        provider.on?.("accountChanged", (pk) => console.log("[Phantom event] accountChanged", pk?.toString?.() || pk));
      } catch (_) {}

      // 1) Connect wallet
      const resp = await doConnect(provider);
      const publicKeyObj = resp?.publicKey || provider.publicKey;
      if (!publicKeyObj) {
        throw new Error("Connected but no publicKey returned by provider.");
      }
      const publicKey = publicKeyObj.toString();
      console.log("Connected pubkey:", publicKey);

      // 2) Fetch nonce message
      const nonceRes = await fetch("{% url 'phantom_nonce' %}", {
        credentials: "same-origin",
        headers: { "Accept": "application/json" }
      });
      const nonceData = await nonceRes.json();
      const message = nonceData.message;

      // 3) Sign message
      const encoded = new TextEncoder().encode(message);
      const signed = await provider.signMessage(encoded, "utf8");

      // 4) Encode signature base58
      const signatureBase58 = base58Encode(signed.signature);

      // 5) Verify with server
      const csrftoken = getCookie("csrftoken");
      const verifyRes = await fetch("{% url 'phantom_verify' %}", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Accept": "application/json",
          "X-CSRFToken": csrftoken || ""
        },
        credentials: "same-origin",
        body: JSON.stringify({ publicKey, signature: signatureBase58, message })
      });

      const verifyData = await verifyRes.json();
      if (!verifyRes.ok || !verifyData.ok) {
        alert("Login failed: " + (verifyData.error || "unknown"));
        return;
      }

      window.location.reload();

    } catch (err) {
      // Print EVERYTHING we can (Phantom sometimes hides useful fields)
      console.error("Phantom connect/sign error:", err);
      console.error("Phantom connect/sign error details:", {
        name: err?.name,
        message: err?.message,
        code: err?.code,
        stack: err?.stack,
        toString: String(err),
      });
      alert("Wallet login error: " + (err?.message || String(err)));
    }
  }

  if (connectBtn) {
    // capture:true helps keep it as a direct user gesture
    connectBtn.addEventListener("click", connectPhantom, { capture: true });
  }
})();
</script>

<script>
(function(){
  const wrap = document.getElementById("lhxAccountWrap");
  const btn  = document.getElementById("lhxAccountBtn");
  const menu = document.getElementById("lhxAccountMenu");

  if (!wrap || !btn || !menu) return;

  function openMenu() {
    wrap.classList.add("open");
    menu.classList.add("open");
    btn.setAttribute("aria-expanded", "true");
  }

  function closeMenu() {
    wrap.classList.remove("open");
    menu.classList.remove("open");
    btn.setAttribute("aria-expanded", "false");
  }

  function toggleMenu(e) {
    e.preventDefault();
    e.stopPropagation();
    const isOpen = wrap.classList.contains("open");
    if (isOpen) closeMenu();
    else openMenu();
  }

  btn.addEventListener("click", toggleMenu, { capture: true });

  document.addEventListener("click", (e) => {
    if (!wrap.contains(e.target)) closeMenu();
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeMenu();
  });
})();
</script>


  <footer class="lhx-footer mt-5">
    <div class="container">
      <div class="lhx-footer-inner">
        <div class="lhx-footer-left">¬© LinkHash</div>
        <div class="lhx-footer-center">Crypto project incubator ¬∑ Accelerator ¬∑ Decentralized rewards ¬∑ Web3.0 games ¬∑ Market analysis</div>
        <div class="lhx-footer-right">
          <div class="lhx-footer-company">LINKHASH CORP</div>
          <div>8 THE GREEN STE A</div>
          <div>DOVER, DE 19901</div>
        </div>
      </div>
    </div>
  </footer>

</body>
</html>
