{% extends "market/base.html" %}
{% load static %}

{% block content %}

<section class="mb-4">
  <div class="lhx-pill">Community</div>
  <div class="d-flex align-items-end justify-content-between flex-wrap gap-3">
    <div>
      <h1 class="lhx-h1 mt-3 mb-2">Leaderboard</h1>
      <p class="lhx-sub mb-0">Ranked by points.</p>
    </div>
  </div>
</section>

<section class="mb-4">
  <div class="lhx-card p-4">

    <!-- Me -->
    <div class="lhx-muted small mb-2">You</div>
    <div class="lhx-card p-3 mb-4"
         style="background: rgba(0,0,0,0.22);
                border: 1px solid rgba(255,255,255,0.06);
                border-radius: 16px;">
      <div class="d-flex align-items-center justify-content-between gap-3 flex-wrap">
        <div>
          <div class="lhx-mono" style="word-break:break-all; color: rgba(255,255,255,.92);">
            {{ wallet_address }}
          </div>
          <div class="lhx-muted small mt-1" style="opacity:.82;">
            {% if my_rank %}Rank <b>#{{ my_rank }}</b> ·{% endif %}
            Points
            <b style="color: rgba(120,255,205,.95);">{{ me.points|default:"0" }}</b>
          </div>
        </div>
        {% if wallet_address %}
          <a class="lhx-btn-sm" href="{% url 'public_profile' wallet_address %}">View my profile</a>
        {% endif %}
      </div>
    </div>

    <!-- Table header row -->
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-2">
      <div class="lhx-muted small">Top users</div>
      <div class="lhx-muted small" style="opacity:.75;">
        Page <b>{{ rows.number }}</b> of <b>{{ rows.paginator.num_pages }}</b>
      </div>
    </div>

    <!-- DARK TABLE WRAP -->
    <div class="table-responsive"
         style="border-radius: 16px;
                overflow: hidden;
                border: 1px solid rgba(255,255,255,0.06);
                background: rgba(0,0,0,0.22);">

      <table class="table-sm mb-0" style="width:100%; border-collapse:collapse;">
        <thead>
          <tr style="background: rgba(0,0,0,0.35);">
            <th style="padding:12px 14px; color: rgba(255,255,255,.72); font-weight:700; width:90px;">
              #
            </th>
            <th style="padding:12px 14px; color: rgba(255,255,255,.72); font-weight:700;">
              Wallet (SOL)
            </th>
            <th style="padding:12px 14px; color: rgba(255,255,255,.72); font-weight:700; text-align:right; width:140px;">
              Points
            </th>
          </tr>
        </thead>

        <tbody>
          {% for u in rows %}
            {% with base=rows.start_index %}
              {% with rank=base|add:forloop.counter0 %}
                <tr style="border-top: 1px solid rgba(255,255,255,0.06);"
                    onmouseover="this.style.background='rgba(35, 255, 170, 0.06)'"
                    onmouseout="this.style.background='transparent'">

                  <!-- Rank -->
                  <td style="padding:12px 14px; color: rgba(255,255,255,.88); font-weight:700;">
                    {{ rank }}
                  </td>

                  <!-- Wallet -->
                  <td style="padding:12px 14px;">
                    <div class="d-flex align-items-center gap-2">
                      <!-- left dot avatar-ish -->
                      <span style="display:inline-flex; width:10px; height:10px; border-radius:999px;
                                   background: rgba(35, 255, 170, 0.55);
                                   box-shadow: 0 0 0 3px rgba(35, 255, 170, 0.10);">
                      </span>

                      <a href="{% url 'public_profile' u.wallet_address %}"
                         class="lhx-mono"
                         style="color: rgba(220,255,245,.92);
                                text-decoration:none;
                                font-weight:700;">
                        {{ u.wallet_address|slice:":4" }}...{{ u.wallet_address|slice:"-4:" }}
                      </a>

                      {% if u.wallet_address == wallet_address %}
                        <span class="lhx-badge" style="border-color: rgba(35,255,170,.30); background: rgba(35,255,170,.10); color: rgba(220,255,245,.92);">
                          YOU
                        </span>
                      {% endif %}
                    </div>

                    <div class="lhx-muted small mt-1" style="opacity:.72;">
                      {% if u.display_name %}{{ u.display_name }}{% else %}Contributor{% endif %}
                    </div>
                  </td>

                  <!-- Points -->
                  <td style="padding:12px 14px; text-align:right;">
                    <span class="lhx-mono" style="font-weight:800; color: rgba(120,255,205,.95);">
                      {{ u.points|default:"0" }}
                    </span>
                  </td>
                </tr>
              {% endwith %}
              {% endwith %}
          {% empty %}
            <tr>
              <td colspan="3" style="padding:14px; color: rgba(255,255,255,.75);">
                No users yet.
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="mt-3 d-flex align-items-center justify-content-between flex-wrap gap-2" style="padding: 0 4px;">
      <div class="lhx-muted small" style="opacity:.8;">
        Page <b>{{ rows.number }}</b> / <b>{{ rows.paginator.num_pages }}</b>
      </div>

      <div class="d-flex align-items-center gap-2 flex-wrap">
        {% if rows.has_previous %}
          <a class="lhx-btn-sm lhx-btn-ghost" href="?page={{ rows.previous_page_number }}">← Prev</a>
        {% else %}
          <span class="lhx-btn-sm lhx-btn-ghost" style="opacity:.45; pointer-events:none;">← Prev</span>
        {% endif %}

        {% if rows.has_next %}
          <a class="lhx-btn-sm lhx-btn-ghost" href="?page={{ rows.next_page_number }}">Next →</a>
        {% else %}
          <span class="lhx-btn-sm lhx-btn-ghost" style="opacity:.45; pointer-events:none;">Next →</span>
        {% endif %}
      </div>
    </div>

  </div>
</section>

{% endblock %}
